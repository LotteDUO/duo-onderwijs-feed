<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Onderwijs – Magazine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --- Basic reset --- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f4ed;
      color: #1f2933;
      padding: 20px;
    }

    .page {
      max-width: 1300px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 20px;
    }

 header h1 {
  font-size: 2.5rem;         
  font-weight: 700;
  color: #2e3a1a;              
letter-spacing: -0.5px;
  margin-bottom: 0.5rem;
}

header p {
  font-size: 1.1rem;         
  color: #2e3a1a;                   
  margin-bottom: 0.1rem;
}

    /* --- Filter bar --- */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      align-items: center;
    }

    .filters label {
      font-size: 0.9rem;
      color: #2e3a1a;
    }

    .filters input[type="text"] {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #2e3a1a;
      min-width: 220px;
      outline: none;
    }

    .filters input[type="text"]:focus {
      border-color: #2e3a1a;
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.15);
    }

    .tag-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag-button {
      border-radius: 999px;
      border: 1px solid #2e3a1a;
      padding: 5px 12px;
      font-size: 0.8rem;
      color: #2e3a1a; 
      background: #cdff79;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease;
    }

    .tag-button.active {
      background: #2e3a1a;
      color: #cdff79;
      border-color: #cdff79;
    }

    .tag-button:hover {
      border-color: #cdff79;
    }

    /* --- Magazine grid --- */
.grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 16px;
  grid-auto-rows: 8px;   /* tiny base row size */
  align-items: start;    /* cards keep their own height */
}

.card {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
  display: block;          /* Grid will size the item */
  width: auto;
  margin: 0;               /* Grid gap controls spacing */
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.1);
    }

    .card-image {
      width: 100%;
      height: 160px;
      background-size: cover;
      background-position: center;
      background-color: #e5e7eb;
    }

.card-content {
  padding: 14px 16px 16px;
}

    .card-title {
      font-size: 1.2rem;
      color: #2e3a1a;
      font-weight: 600;
      line-height: 1;
      margin-bottom: 6px; 
    }

    .card-meta {
      font-size: 0.8rem;
      color: #6b7280;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px; 
    }

    .card-description {
      font-size: 0.85rem;
      color: #4b5563;
      flex: 1;
      margin-bottom: 10px; 
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .card-tag {
      font-size: 0.7rem;
      background: #cdff79;
      color: #2e3a1a;
      padding: 3px 8px;
      border-radius: 999px;
    }

.card-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

.card-readmore {
  font-size: 1rem;
  font-weight: 600;
  margin-right: 6px; 
  text-decoration: none;
  color: #2e3a1a;
  white-space: nowrap; /* prevents wrap */
}

.card-readmore:hover {
  text-decoration: underline;
}

    .card-footer a:hover {
      text-decoration: underline;
    }

    .status {
      margin: 10px 0 5px;
      font-size: 0.85rem;
      margin-bottom: 8px;
      color: #2e3a1a;
    }

    .status.error {
      color: #b91c1c;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.5rem;
      }

      .card-image {
        height: 140px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1 id="feedTitle">DUO-Onderwijs Nieuwsfeed</h1>
      <p id="feedDescription">Nieuws uit het onderwijs, automatisch verzameld.</p>
    </header>

    <!-- Filters -->
    <div class="filters">
      <label>
        Zoeken:
        <input type="text" id="searchInput" placeholder="Filter op titel, tekst of bron…" />
      </label>
      <div class="tag-buttons" id="tagButtons">
        <!-- Tag buttons will be injected here -->
      </div>
    </div>

    <div id="status" class="status">Artikelen worden geladen…</div>

    <!-- Magazine grid -->
    <div id="grid" class="grid"></div>
  </div>

  <script>
    // JSON Feed URL for this magazine
    const FEED_URL = "https://rss.app/feeds/v1.1/_5VKbx4jDjq4BE7Jl.json";

    let allArticles = [];
    let activeTags = new Set();
    let searchQuery = "";

    document.addEventListener("DOMContentLoaded", () => {
      fetchFeed();
      setupSearch();
    });

    async function fetchFeed() {
      const statusEl = document.getElementById("status");

      try {
        statusEl.textContent = "Artikelen worden geladen…";

        const response = await fetch(FEED_URL);
        if (!response.ok) {
          throw new Error("HTTP error " + response.status);
        }

        const data = await response.json();

        const items = data.items || [];
        allArticles = items.map(mapItemToArticle);

        buildTagButtons(allArticles);
        renderArticles();

        statusEl.textContent = "Geladen: " + allArticles.length + " artikelen.";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Laden is mislukt. Zie console voor details.";
        statusEl.classList.add("error");
      }
    }

function extractHostFromUrl(url) {
  try {
    const u = new URL(url);
    return u.hostname.replace(/^www\./, "");
  } catch (e) {
    return "";
  }
}

// Map hostnames to nice, stable source labels
function hostToSourceLabel(host) {
  const map = {
    "aob.nl": "AOb",
    "poraad.nl": "PO-Raad",
    "kennisnet.nl": "Kennisnet",
    "lezen.nl": "Stichting Lezen",
    "nro.nl": "NRO",
    "vo-raad.nl": "VO-raad",
    "cito.nl": "Cito",
    "vorsite.nl": "VOR",
"slo.nl": "SLO"
    // you can add more later if needed
  };
  return map[host] || "";
}

// Provide a default image for each known source/host
function fallbackImageForHost(host) {
  const map = {
    "aob.nl": "https://i.ytimg.com/vi/oRAxkBjuEkA/hq720.jpg?sqp=-oaymwE7CK4FEIIDSFryq4qpAy0IARUAAAAAGAElAADIQj0AgKJD8AEB-AH-CYAC0AWKAgwIABABGCMgZSgYMA8=&rs=AOn4CLCBSJUW1ORaDc-EY3JpgpnUyrvnGw",
    "poraad.nl": "https://www.poraad.nl/logo.svg",
    "kennisnet.nl": "https://van-ons.nl/wp-content/uploads/2024/10/Website-development-Kennisnet-internetbureau-Van-Ons.png",
    "lezen.nl": "https://www.noblestreet.eu/wp-content/uploads/2022/08/stichting-lezen.jpg",
    "nro.nl": "https://media.licdn.com/dms/image/v2/D4E22AQHg5yqWPpeI-A/feedshare-shrink_800/B4EZova_k6IoAk-/0/1761732197755?e=2147483647&v=beta&t=S6ODw3RPQxinfcZVEtenfUdkqML0Yy8aYNmPHxixV0k",
    "vo-raad.nl": "https://cdn.sanity.io/images/mccftp3c/production/551a786ef3eeead61918fe982fd5e586140697fa-1500x855.jpg",
    "cito.nl": "https://www.marketingaccent.nl/wp-content/uploads/2015/01/logo-cito.jpg",
    "vorsite.nl": "https://www.aera.net/portals/38/dutch_1.png",
"slo.nl": "https://upload.wikimedia.org/wikipedia/commons/d/dd/Logo_SLO.jpg"
  };
  return map[host] || "https://upload.wikimedia.org/wikipedia/commons/8/89/Graduation_cap_icon.svg"; // universal fallback
}

    // Map this JSON Feed structure to a normalized article object
    function mapItemToArticle(item) {
  const title = item.title || "Untitled";
  const link = item.url || "#";
  const description = item.content_text || "";
  const pubDate = item.date_published || "";

  // Full author string from the feed, still shown on the card
  let author = "";
  if (Array.isArray(item.authors) && item.authors.length > 0 && item.authors[0].name) {
    author = item.authors[0].name;
  }

// Determine main image
let image = "";
if (item.image) {
  image = item.image;
} else if (Array.isArray(item.attachments) && item.attachments.length > 0 && item.attachments[0].url) {
  image = item.attachments[0].url;
} else {
  // No image in the feed → use fallback based on host
  const host = extractHostFromUrl(link);
  image = fallbackImageForHost(host);
}

  // NEW: derive a stable source tag from the URL/domain
  const host = extractHostFromUrl(link);
  const sourceLabel = hostToSourceLabel(host) || host || author;

  const categories = sourceLabel ? [sourceLabel] : [];

  return {
    title,
    link,
    description,
    pubDate,
    author,      // still used for display under the title
    categories,  // now stable, organisation-based tags
    image
  };
}


    function buildTagButtons(articles) {
      const tagButtonsContainer = document.getElementById("tagButtons");
      tagButtonsContainer.innerHTML = "";

      const tagSet = new Set();
      articles.forEach(article => {
        article.categories.forEach(tag => {
          if (tag && typeof tag === "string") {
            tagSet.add(tag.trim());
          }
        });
      });

      const tags = Array.from(tagSet).sort();

      if (tags.length === 0) {
        return;
      }

      tags.forEach(tag => {
        const btn = document.createElement("button");
        btn.className = "tag-button";
        btn.textContent = tag;
        btn.dataset.tag = tag;

        btn.addEventListener("click", () => {
          if (activeTags.has(tag)) {
            activeTags.delete(tag);
            btn.classList.remove("active");
          } else {
            activeTags.add(tag);
            btn.classList.add("active");
          }
          renderArticles();
        });

        tagButtonsContainer.appendChild(btn);
      });
    }

    function setupSearch() {
      const input = document.getElementById("searchInput");
      input.addEventListener("input", (event) => {
        searchQuery = event.target.value.toLowerCase();
        renderArticles();
      });
    }

    function renderArticles() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      const filtered = allArticles.filter(article => {
        // Tag filter
        if (activeTags.size > 0) {
          const hasTag = article.categories.some(tag => activeTags.has(tag));
          if (!hasTag) return false;
        }

        // Text search
        if (searchQuery) {
          const text = (
            article.title +
            " " +
            article.description +
            " " +
            article.author
          ).toLowerCase();
          if (!text.includes(searchQuery)) return false;
        }

        return true;
      });

      filtered.forEach(article => {
        const card = createCard(article);
        grid.appendChild(card);
      });

applyMasonry();
window.addEventListener("resize", () => applyMasonry());
      
      const statusEl = document.getElementById("status");
      if (filtered.length === 0 && allArticles.length > 0) {
        statusEl.textContent = "Geen artikelen matchen deze filters.";
      } else if (allArticles.length > 0) {
        statusEl.textContent = "Weergegeven: " + filtered.length + " van " + allArticles.length + " artikelen.";
        statusEl.classList.remove("error");
      }
    }

    function createCard(article) {
      const card = document.createElement("article");
      card.className = "card";

      if (article.image) {
        const imgDiv = document.createElement("div");
        imgDiv.className = "card-image";
        imgDiv.style.backgroundImage = `url("${article.image}")`;
        card.appendChild(imgDiv);
      }

      const content = document.createElement("div");
      content.className = "card-content";

      const titleEl = document.createElement("h2");
      titleEl.className = "card-title";
      titleEl.textContent = article.title;
      content.appendChild(titleEl);

      const meta = document.createElement("div");
      meta.className = "card-meta";
      if (article.pubDate) {
        const dateObj = new Date(article.pubDate);
        const dateSpan = document.createElement("span");
        dateSpan.textContent = dateObj.toLocaleDateString(undefined, {
          year: "numeric",
          month: "short",
          day: "numeric"
        });
        meta.appendChild(dateSpan);
      }
      if (article.author) {
        const authorSpan = document.createElement("span");
        authorSpan.textContent = "· " + article.author;
        meta.appendChild(authorSpan);
      }
      content.appendChild(meta);

      if (article.description) {
        const desc = document.createElement("p");
        desc.className = "card-description";
        desc.textContent =
          article.description.length > 220
            ? article.description.slice(0, 220) + "…"
            : article.description;
        content.appendChild(desc);
      }

// Bottom row: tags (left) + "Lees meer" (right)
const bottomRow = document.createElement("div");
bottomRow.className = "card-bottom";

const tagsContainer = document.createElement("div");
tagsContainer.className = "card-tags";
article.categories.forEach(tag => {
  const span = document.createElement("span");
  span.className = "card-tag";
  span.textContent = tag;
  tagsContainer.appendChild(span);
});
bottomRow.appendChild(tagsContainer);

const readMore = document.createElement("a");
readMore.className = "card-readmore";
readMore.href = article.link;
readMore.target = "_blank";
readMore.rel = "noopener noreferrer";
readMore.textContent = "Lees meer →";
bottomRow.appendChild(readMore);

content.appendChild(bottomRow);
card.appendChild(content);

return card;
    }
function applyMasonry() {
  const grid = document.getElementById("grid");
  const row = parseInt(getComputedStyle(grid).getPropertyValue("grid-auto-rows"), 10);
  const gap = parseInt(getComputedStyle(grid).getPropertyValue("gap"), 10);

  Array.from(grid.children).forEach(item => {
    const height = item.getBoundingClientRect().height;
    const span = Math.ceil((height + gap) / (row + gap));
    item.style.gridRowEnd = `span ${span}`;
  });
}
  </script>
</body>

</html>

